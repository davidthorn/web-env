tinymce.create("tinymce.plugins.MediaSelectionPlugin",{ed:null,imageCls:"tinymce-editor-image",linkCls:"tinymce-editor-link",videoCls:"tinymce-editor-video",audioCls:"tinymce-editor-audio",url:null,init:function(e,t){var i=this;i.ed=e,i.url=t,e.addCommand("mceMediaSelection",function(){var n=!1;"function"!=typeof Shopware.app.Application.addSubApplication&&Ext.Error.raise({msg:"Your ExtJS application does not support sub applications",option:[e,t]}),i.ed.settings&&i.ed.settings.fullscreen_is_enabled&&(n=!0),Shopware.app.Application.addSubApplication({name:"Shopware.apps.MediaManager",layout:"small",forceToFront:n,selectionMode:"single",eventScope:i,mediaSelectionCallback:i._processImage})}),e.addButton("media_selection",{title:"Media Selection",cls:"tinymce-media-selection",cmd:"mceMediaSelection",image:t+"/assets/inbox-image.png"})},getInfo:function(){return{longname:"MediaManager - MediaSelection",author:"shopware AG - st.pohl",authorurl:"http://www.shopware.com",infourl:"http://developers.shopware.com",version:"1.1.1"}},_processImage:function(e){var t,i=this,n=i.ed,a=e.up("window"),o=a.down(".mediamanager-media-view");t=(o="grid"===o.selectedLayout?o.dataView:o.cardContainer.getLayout().getActiveItem()).getSelectionModel().getSelection(),Ext.each(t,function(e){var t=e.get("type"),a=e.get("extension").toLowerCase();"VIDEO"===t?i._insertVideo(e):"IMAGE"===t||"svg"===a?i._insertImage(e):"MUSIC"===t?i._insertAudio(e):i._insertLink(e),n.undoManager.add()}),a.destroy()},_insertImage:function(e){var t,i=this,n=i.ed,a=Shopware.ModuleManager.uuidGenerator.generate();t={id:i.imageCls+"-"+a,class:i.imageCls+" "+i.imageCls+"-"+a,alt:e.get("name"),"data-src":e.get("virtualPath"),src:i.url+"/assets/placeholder-image.png"},n.execCommand("mceInsertContent",!1,tinymce.DOM.createHTML("img",t),{skip_undo:1});var o=new Event("insertMedia");return document.dispatchEvent(o),!0},_insertLink:function(e){var t,i=this.ed;return t={class:this.linkCls,href:e.get("path"),title:e.get("name"),target:"_blank"},i.execCommand("mceInsertContent",!1,tinymce.DOM.createHTML("a",t,e.get("name")),{skip_undo:1}),!0},_insertVideo:function(e){var t,i=this.ed;return t={class:this.videoCls,width:320,height:240,src:e.get("path"),controls:!0},i.execCommand("mceInsertContent",!1,tinymce.DOM.createHTML("video",t),{skip_undo:1}),!0},_insertAudio:function(e){var t,i=this.ed;return t={class:this.audioCls,src:i.settings.document_base_url+e.get("path"),controls:!0},i.execCommand("mceInsertContent",!1,tinymce.DOM.createHTML("audio",t),{skip_undo:1}),!0}}),tinymce.PluginManager.add("media_selection",tinymce.plugins.MediaSelectionPlugin);
